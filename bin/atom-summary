#!/usr/bin/ruby

require 'rubygems'
require 'atom'
require 'net/http'
require 'uri'
require 'getoptlong'
require 'rdoc/usage'

opts = GetoptLong.new(
  ['--help', '-h', GetoptLong::NO_ARGUMENT],
  ['--feed', '-f', GetoptLong::REQUIRED_ARGUMENT],
  ['--verbose', '-v', GetoptLong::OPTIONAL_ARGUMENT]
)

feed_url = nil
verbose = false

opts.each do |opt, arg|
  case opt
  when '--help'
    RDoc::usage
  when '--feed'
    feed_url = arg
  when '--verbose'
    verbose = true
  end
end

feed_xml = Net::HTTP.get(URI::parse(feed_url))
feed = Atom::Feed.new(feed_xml)

feed.entries.reverse.each { |entry|
  puts "[#{entry.updated.getlocal.strftime '%I:%M %p'}] #{entry.title.sub(/\n.*$/m, '')}"
}